<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Liga Acadêmica de Biologia Imaculada Conceição</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="assets/images/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uW/r8Wl630WpD/jXgD0R8T2bB/pG/Pz4Jp5X5K5e5p5d5e5p5u5g5u5g5u5g5u5g5u5g5u5g5u5g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html">
                    <span class="fs-4">Liga Acadêmica</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="projeto.html">O Projeto</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="referencial.html">Referencial</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="resultados.html">Resultados</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="publicacoes.html">Publicações</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="blog.html">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="dados.html">Dados</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="glossario.html">Glossário</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="sobre.html">Sobre</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contato.html">Contato</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="login.html">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cadastro.html">Cadastro</a>
                        </li>
                        <li class="nav-item dark-mode-toggle-container">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="darkModeToggle">
                                <label class="form-check-label" for="darkModeToggle">
                                    <i class="fas fa-sun"></i>
                                    <i class="fas fa-moon"></i>
                                </label>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="container my-5">
            <section class="text-center" data-aos="fade-up">
                <h1 class="display-4 fw-bold">Blog da Liga</h1>
                <p class="lead">Artigos e atualizações sobre os projetos e a pesquisa da nossa equipe.</p>
            </section>
            
            <section class="mt-5">
                <div class="filter-buttons mb-4">
                    <button class="btn btn-primary active" data-filter="all">Todos</button>
                    <button class="btn btn-secondary" data-filter="noticias">Notícias</button>
                    <button class="btn btn-secondary" data-filter="artigos">Artigos</button>
                    <button class="btn btn-secondary" data-filter="publicacoes">Publicações</button>
                </div>

                <div id="all-posts">
                    <div class="text-center mt-5">
                        <p>Conteúdo do blog a ser adicionado em breve.</p>
                    </div>
                </div>

                <div id="add-post-form-container" class="mt-5" style="display: none;">
                    <h2>Adicionar Nova Postagem</h2>
                    <form id="add-post-form">
                        <div class="mb-3">
                            <label for="post-title" class="form-label">Título</label>
                            <input type="text" class="form-control" id="post-title" required>
                        </div>
                        <div class="mb-3">
                            <label for="post-category" class="form-label">Categoria</label>
                            <select class="form-select" id="post-category" required>
                                <option value="" selected disabled>Selecione uma categoria</option>
                                <option value="noticias">Notícias</option>
                                <option value="artigos">Artigos</option>
                                <option value="publicacoes">Publicações</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="post-excerpt" class="form-label">Resumo</label>
                            <textarea class="form-control" id="post-excerpt" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="post-content" class="form-label">Conteúdo Completo</label>
                            <textarea class="form-control" id="post-content" rows="10" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="post-tags" class="form-label">Tags (separadas por vírgula)</label>
                            <input type="text" class="form-control" id="post-tags">
                        </div>
                        <button type="submit" class="btn btn-success">Publicar</button>
                    </form>
                </div>

                <div id="message-container" class="mt-3"></div>

            </section>
        </div>
    </main>

    <footer>
        <p>&copy; Liga Acadêmica de Biologia Imaculada Conceição | Todos os direitos reservados.</p>
        <p>Orientação: Prof. Vanbasten Rocha</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, orderBy, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        const firebaseConfig = {
             apiKey: "",
             authDomain: "",
             projectId: "",
             storageBucket: "",
             messagingSenderId: "",
             appId: "",
             measurementId: ""
         };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const addPostFormContainer = document.getElementById('add-post-form-container');
        const addPostForm = document.getElementById('add-post-form');
        const allPostsContainer = document.getElementById('all-posts');
        const filterButtons = document.querySelectorAll('.filter-buttons .btn');

        // Authentication State Listener to show/hide add post form
        onAuthStateChanged(auth, (user) => {
            if (user) {
                addPostFormContainer.style.display = 'block';
            } else {
                addPostFormContainer.style.display = 'none';
            }
        });

        const fetchPosts = async () => {
            allPostsContainer.innerHTML = '';
            const q = query(collection(db, "blog-posts"), orderBy("timestamp", "desc"));
            const querySnapshot = await getDocs(q);
            if (querySnapshot.empty) {
                allPostsContainer.innerHTML = '<p class="text-center">Nenhuma postagem encontrada.</p>';
                return;
            }
            querySnapshot.forEach((doc) => {
                const post = doc.data();
                const postElement = document.createElement('div');
                postElement.classList.add('blog-post', 'card', 'mb-4', 'shadow-sm');
                postElement.dataset.category = post.category;
                postElement.setAttribute('data-aos', 'fade-up');
                postElement.innerHTML = `
                    <div class="card-body">
                        <h2 class="card-title">${post.title}</h2>
                        <p class="card-text"><small class="text-muted">${new Date(post.timestamp.seconds * 1000).toLocaleDateString()}</small></p>
                        <p class="card-text">${post.excerpt}</p>
                        <a href="#" class="btn btn-primary btn-sm">Leia mais</a>
                    </div>
                `;
                allPostsContainer.appendChild(postElement);
            });
        };

        fetchPosts();

        // Handle Add Post Form Submission
        addPostForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('post-title').value;
            const category = document.getElementById('post-category').value;
            const excerpt = document.getElementById('post-excerpt').value;
            const content = document.getElementById('post-content').value;
            const tags = document.getElementById('post-tags').value.split(',').map(tag => tag.trim());

            const newPost = {
                title,
                category,
                excerpt,
                content,
                tags,
                timestamp: serverTimestamp(),
            };

            try {
                const docRef = await addDoc(collection(db, `artifacts/blog-posts/public/data/blog-posts`), newPost);
                console.log("Document written with ID: ", docRef.id);
                showMessage("Postagem adicionada com sucesso!");
                addPostForm.reset();
            } catch (e) {
                console.error("Error adding document: ", e);
                showMessage("Erro ao adicionar a postagem. " + e.message, 'danger');
            }
        });

        // Filtering functionality
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const filter = button.dataset.filter;
                const allPosts = document.querySelectorAll('#all-posts .blog-post');
                allPosts.forEach(post => {
                    const postCategory = post.dataset.category;
                    if (filter === 'all' || postCategory === filter) {
                        post.style.display = 'block';
                    } else {
                        post.style.display = 'none';
                    }
                });
            });
        });

    </script>
</body>
</html>
